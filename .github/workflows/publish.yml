name: Publish Texture Pack to Modrinth

on:
  release:
    types: [published]

jobs:
  publish:
    name: Validate, Package, and Publish Texture Pack
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Validate JSON Files
        run: |
          for file in $(find . -name "*.json"); do
            if ! jq empty "$file"; then
              echo "Invalid JSON: $file"
              exit 1
            fi
          done

      - name: Validate pack.mcmeta
        run: |
          if [ ! -f "pack.mcmeta" ]; then
            echo "Error: pack.mcmeta is missing!"
            exit 1
          fi
          if ! jq -e '.pack.pack_format' pack.mcmeta > /dev/null; then
            echo "Error: pack_format is missing in pack.mcmeta!"
            exit 1
          fi

      - name: Package Texture Pack
        run: zip -r texturepack.zip . -x ".git/*"

      - name: Publish to Modrinth
        uses: Kir-Antipov/mc-publish@v3.3
        with:
          modrinth-id: rERW3QhL
          modrinth-token: ${{ secrets.MODRINTH_TOKEN }}
          github-tag: ${{ github.event.release.tag_name }}
          name: ${{ github.event.release.name }}
          version: ${{ github.event.release.tag_name }}
          changelog: ${{ github.event.release.body }}
          type: resourcepack
          loaders: minecraft
          game-versions: |-
            1.19.3
            1.19.4
          files: texturepack.zip
